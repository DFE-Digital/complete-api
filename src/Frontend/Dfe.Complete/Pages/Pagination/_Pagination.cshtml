@using NetEscapades.AspNetCore.SecurityHeaders;
@model Dfe.Complete.Pages.Pagination.PaginationModel
@{
  var prefix = !string.IsNullOrEmpty(Model.ElementIdPrefix) ? Model.ElementIdPrefix : "";

  var nextPageLink = $"{Model.Url}?pageNumber={Model.Next}";

  var previousPageLink = $"{Model.Url}?pageNumber={Model.Previous}";

  var nonce = Context.GetNonce();

  var paginationContainerId = $"{prefix}pagination-container";
  var nextButtonId = $"{prefix}next-page";
  var previousButtonId = $"{prefix}previous-page";
  var pagesToDisplay = new List<int>() { 1, Model.PageNumber, Model.TotalPages };
  if (Model.Previous.HasValue)
    pagesToDisplay.Add((int)Model.Previous);
  if (Model.Next.HasValue)
    pagesToDisplay.Add((int)Model.Next);
}

@if (Model.TotalPages > 1)
{
  <govuk-pagination id="@paginationContainerId">
    @if (Model.HasPrevious)
    {
      <govuk-pagination-previous href="@previousPageLink" id="@previousButtonId" data-testid="@previousButtonId"/>
    }
    @for (var pageIdx = 0; pageIdx < Model.TotalPages; pageIdx++)
    {
      var pageNumber = pageIdx + 1;
      var isCurrentPage = Model.PageNumber == pageNumber;
      var pageNumberLinkId = $"{prefix}page-{pageNumber}";
      var ariaCurrentPage = isCurrentPage ? "true" : "false";
      var ariaLabel = isCurrentPage ? $"Current page, page {pageNumber}" : $"Go to page {pageNumber}";

      if (!pagesToDisplay.Contains(pageNumber))
      {
        continue;
      }

      if (Model.Previous.HasValue && Model.Previous == pageNumber && Model.Previous - 1 > 1)
      {
        <govuk-pagination-ellipsis/>
      }

      <govuk-pagination-item id="@pageNumberLinkId" href="@Model.Url?pageNumber=@pageNumber" is-current="@isCurrentPage" aria-current="@ariaCurrentPage" aria-label="@ariaLabel">
        @pageNumber
      </govuk-pagination-item>

      if (Model.Next.HasValue && Model.Next == pageNumber && Model.Next + 1 < Model.TotalPages)
      {
        <govuk-pagination-ellipsis/>
      }
    }
    @if (Model.HasNext)
    {
      <govuk-pagination-next href="@nextPageLink" id="@nextButtonId" data-testid="@nextButtonId"/>
    }
  </govuk-pagination>
  // When pagination is used on the screen without a full page refresh
  @* if (!string.IsNullOrEmpty(Model.ContentContainerId)) *@
  @* { *@
  @*     <script type="application/javascript" nonce="@nonce"> *@
  @* *@
  @*         $(function () { *@
  @*             onPageMoved(); *@
  @* *@
  @*             function onPageMoved() { *@
  @*                 $("#@nextButtonId").on("click", function (e) { *@
  @*                     e.preventDefault(); *@
  @* *@
  @*                     const pageNumber = $('#@nextPageValueId').val(); *@
  @* *@
  @*                     refreshContent(pageNumber); *@
  @*                 }); *@
  @* *@
  @*                 $("#@previousButtonId").on("click", function (e) { *@
  @*                     e.preventDefault(); *@
  @* *@
  @*                     const pageNumber = $('#@previousPageValueId').val(); *@
  @* *@
  @*                     refreshContent(pageNumber); *@
  @*                 }); *@
  @* *@
  @*                 var numberedPageLinks = $('#@paginationContainerId').find('[data-page-number-link]'); *@
  @* *@
  @*                 numberedPageLinks.each(function () { *@
  @*                     const pageNumber = $(this).data('page-number-link'); *@
  @* *@
  @*                     $(this).click(function (e) { *@
  @* *@
  @*                         e.preventDefault(); *@
  @* *@
  @*                         refreshContent(pageNumber); *@
  @*                     }); *@
  @*                 }); *@
  @*             } *@
  @* *@
  @*             function refreshContent(pageNumber) { *@
  @* *@
  @*                 const url = `@Html.Raw(Model.Url)?pageNumber=${pageNumber}`; *@
  @* *@
  @*                 $.get(url) *@
  @*                     .done(function (response) { *@
  @*                         $("#@Model.ContentContainerId").html(response); *@
  @*                         onPageMoved(); *@
  @*                     }); *@
  @*             } *@
  @*         }); *@
  @*     </script> *@
  @* } *@
}